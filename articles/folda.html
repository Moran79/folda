<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to folda • folda</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to folda">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">folda</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/folda.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Moran79/folda/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to folda</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Moran79/folda/blob/master/vignettes/folda.Rmd" class="external-link"><code>vignettes/folda.Rmd</code></a></small>
      <div class="d-none name"><code>folda.Rmd</code></div>
    </div>

    
    
<p>The <code>folda</code> package is an R modeling tool designed for
fitting Forward Stepwise Linear Discriminant Analysis (LDA) and
Uncorrelated Linear Discriminant Analysis (ULDA). If you’re unfamiliar
with stepwise LDA or ULDA, please refer to the following resources:</p>
<ul>
<li><p>For stepwise LDA using Wilks’ Lambda, see Section 6.11.1 in
<em>Methods of Multivariate Analysis, Third Edition</em> by Alvin C.
Rencher and William F. Christensen (2012).</p></li>
<li><p>For ULDA, refer to Ye, J., &amp; Yu, B. (2005).
<em>Characterization of a family of algorithms for generalized
discriminant analysis on undersampled problems.</em> Journal of Machine
Learning Research, 6(4). <a href="https://www.jmlr.org/papers/volume6/ye05a/ye05a.pdf" class="external-link">Link</a>.</p></li>
<li><p>For a combination of ULDA and forward LDA using Pillai’s trace,
see Wang, S. (2024). <em>A New Forward Discriminant Analysis Framework
Based on Pillai’s Trace and ULDA</em>. arXiv preprint arXiv:2409.03136.
<a href="https://arxiv.org/abs/2409.03136" class="external-link">Link</a>.</p></li>
</ul>
<div class="section level2">
<h2 id="why-use-the-folda-package">Why use the <code>folda</code> package?<a class="anchor" aria-label="anchor" href="#why-use-the-folda-package"></a>
</h2>
<p>If you’ve ever been frustrated by the warnings and errors from
<code><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">MASS::lda()</a></code>, you will appreciate the ULDA implementation in
<code><a href="../reference/folda.html">folda()</a></code>. It offers several key improvements:</p>
<ul>
<li><p><strong>No more “constant within group” errors!</strong> ULDA can
handle constant columns and perfect separation of groups.</p></li>
<li><p><strong>Automatic missing value handling!</strong> The
implementation seamlessly integrates automatic missing value imputation
during both training and testing phases.</p></li>
<li><p><strong>Fast!</strong> ULDA is implemented using the Generalized
Singular Value Decomposition (GSVD) method, which diagonalizes both
within-class and total scatter matrices simultaneously, offering a speed
advantage over the sequential diagonalization used in
<code><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">MASS::lda()</a></code> (see Howland et al., 2003 for more details). We
have also rewritten the matrix decomposition modules (SVD, QR) using
<code>RcppEigen</code>, further improving computational efficiency by
leveraging optimized C++ code.</p></li>
<li><p><strong>Better visualization!</strong> <code>folda</code> uses
<code>ggplot2</code> to provide visualizations of class separation in
projected 2D spaces (or 1D histograms), offering valuable
insights.</p></li>
</ul>
<p>For the forward LDA implementation, <code>folda</code> offers the
following advantages over the classical framework:</p>
<ul>
<li><p><strong>No issues with multicollinearity or perfect linear
dependency!</strong> Since <code><a href="../reference/folda.html">folda()</a></code> is built on ULDA, it
effectively solves for the scaling matrix.</p></li>
<li><p><strong>Handles perfect separation and offers greater
power!</strong> The classical approach using Wilks’ Lambda has known
limitations, including premature stopping when some (not all) groups are
perfectly separated. Pillai’s trace, as used in <code><a href="../reference/folda.html">folda()</a></code>,
not only effectively addresses perfect separation, but has also been
shown to generally have greater statistical power than Wilks’ Lambda
(Rencher et al., 2002).</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="basic-usage-of-folda">Basic Usage of <code>folda</code><a class="anchor" aria-label="anchor" href="#basic-usage-of-folda"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Moran79/folda" class="external-link">folda</a></span><span class="op">)</span></span>
<span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/mpg.html" class="external-link">mpg</a></span><span class="op">)</span> <span class="co"># Prepare the data</span></span>
<span><span class="va">datX</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span> <span class="co"># All predictors without Y</span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span> <span class="co"># we try to predict "cyl" (number of cylinders)</span></span></code></pre></div>
<p>Build a ULDA model with all variables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span>datX <span class="op">=</span> <span class="va">datX</span>, response <span class="op">=</span> <span class="va">response</span>, subsetMethod <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p>Build a ULDA model with forward selection via Pillai’s trace:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span>datX <span class="op">=</span> <span class="va">datX</span>, response <span class="op">=</span> <span class="va">response</span>, subsetMethod <span class="op">=</span> <span class="st">"forward"</span>, testStat <span class="op">=</span> <span class="st">"Pillai"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># 6 out of 11 variables are selected, displ is the most important among them</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Pillai's trace: 1.325</span></span>
<span><span class="co">#&gt; Associated p-value: 4.636e-74</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction Results on Training Data:</span></span>
<span><span class="co">#&gt; Refitting Accuracy: 0.9188</span></span>
<span><span class="co">#&gt; Gini Index: 0.7004</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confusion Matrix:</span></span>
<span><span class="co">#&gt;          Actual</span></span>
<span><span class="co">#&gt; Predicted  4  5  6  8</span></span>
<span><span class="co">#&gt;         4 69  0  3  0</span></span>
<span><span class="co">#&gt;         5  8  4  2  0</span></span>
<span><span class="co">#&gt;         6  4  0 74  2</span></span>
<span><span class="co">#&gt;         8  0  0  0 68</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Group means of LD scores:</span></span>
<span><span class="co">#&gt;           LD1         LD2        LD3</span></span>
<span><span class="co">#&gt; 4 -3.05298379 -0.02700248 -0.3555829</span></span>
<span><span class="co">#&gt; 5 -1.87744449  4.45014946  0.8156167</span></span>
<span><span class="co">#&gt; 6 -0.06757888 -0.28356907  0.5911862</span></span>
<span><span class="co">#&gt; 8  3.71628852  0.09697943 -0.3023424</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Forward Selection Results:</span></span>
<span><span class="co">#&gt;                var statOverall   statDiff  threshold</span></span>
<span><span class="co">#&gt; 1            displ    0.873393 0.87339300 0.06545381</span></span>
<span><span class="co">#&gt; 2  modelnew beetle    1.029931 0.15653777 0.05673510</span></span>
<span><span class="co">#&gt; 3       modeljetta    1.141651 0.11172064 0.05496185</span></span>
<span><span class="co">#&gt; 4 modelcaravan 2wd    1.210165 0.06851331 0.05363507</span></span>
<span><span class="co">#&gt; 5     classmidsize    1.263449 0.05328468 0.05276500</span></span>
<span><span class="co">#&gt; 6              cty    1.325255 0.06180560 0.05194279</span></span></code></pre></div>
<p>Plot the results:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, datX <span class="op">=</span> <span class="va">datX</span>, response <span class="op">=</span> <span class="va">response</span><span class="op">)</span></span></code></pre></div>
<p><img src="folda_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Make predictions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">datX</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "4" "4" "4" "4" "6" "4"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">datX</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Posterior probabilities</span></span>
<span><span class="co">#&gt;           4            5            6            8</span></span>
<span><span class="co">#&gt; 1 0.9966769 7.475058e-08 0.0033230408 7.023764e-12</span></span>
<span><span class="co">#&gt; 2 0.9994438 1.401133e-08 0.0005562131 5.338710e-13</span></span>
<span><span class="co">#&gt; 3 0.9970911 3.835722e-08 0.0029088506 1.738154e-11</span></span>
<span><span class="co">#&gt; 4 0.9983963 2.196016e-08 0.0016037009 7.365641e-12</span></span>
<span><span class="co">#&gt; 5 0.3122116 6.809673e-07 0.6877815595 6.173116e-06</span></span>
<span><span class="co">#&gt; 6 0.5995781 4.275271e-07 0.4004193019 2.123291e-06</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparison-of-pillais-trace-and-wilks-lambda">Comparison of Pillai’s Trace and Wilks’ Lambda<a class="anchor" aria-label="anchor" href="#comparison-of-pillais-trace-and-wilks-lambda"></a>
</h2>
<p>Here, we compare their performances in a scenario where one group of
classes is perfectly separable from another, a condition under which
Wilks’ Lambda performs poorly. Now let’s predict the model of the
car.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitW</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span>, <span class="va">mpg</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, testStat <span class="op">=</span> <span class="st">"Wilks"</span><span class="op">)</span></span>
<span><span class="va">fitW</span><span class="op">$</span><span class="va">forwardInfo</span></span>
<span><span class="co">#&gt;                var statOverall statDiff threshold</span></span>
<span><span class="co">#&gt; 1 manufactureraudi           0        0 0.7338759</span></span></code></pre></div>
<p>Wilks’ Lambda only selects manufacturer-audi, since it can separate
a4, a4 quattro, and a6 quattro from other models. However, it
unexpectedly stops since the Wilks’ Lambda = 0, leading to a refitting
accuracy of 0.0812.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span>, <span class="va">mpg</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, testStat <span class="op">=</span> <span class="st">"Pillai"</span><span class="op">)</span></span>
<span><span class="va">fitP</span><span class="op">$</span><span class="va">forwardInfo</span></span>
<span><span class="co">#&gt;                       var statOverall  statDiff threshold</span></span>
<span><span class="co">#&gt; 1       manufacturerdodge     1.00000 1.0000000 0.2654136</span></span>
<span><span class="co">#&gt; 2  manufacturervolkswagen     2.00000 1.0000000 0.2599086</span></span>
<span><span class="co">#&gt; 3        manufactureraudi     3.00000 1.0000000 0.2543730</span></span>
<span><span class="co">#&gt; 4        manufacturerford     4.00000 1.0000000 0.2488055</span></span>
<span><span class="co">#&gt; 5   manufacturerchevrolet     5.00000 1.0000000 0.2432051</span></span>
<span><span class="co">#&gt; 6       manufacturerhonda     6.00000 1.0000000 0.2375706</span></span>
<span><span class="co">#&gt; 7     manufacturerhyundai     7.00000 1.0000000 0.2319008</span></span>
<span><span class="co">#&gt; 8        manufacturerjeep     8.00000 1.0000000 0.2261943</span></span>
<span><span class="co">#&gt; 9  manufacturerland rover     9.00000 1.0000000 0.2204496</span></span>
<span><span class="co">#&gt; 10    manufacturerlincoln    10.00000 1.0000000 0.2146652</span></span>
<span><span class="co">#&gt; 11    manufacturermercury    11.00000 1.0000000 0.2088394</span></span>
<span><span class="co">#&gt; 12     manufacturernissan    12.00000 1.0000000 0.2029702</span></span>
<span><span class="co">#&gt; 13    manufacturerpontiac    13.00000 1.0000000 0.1970556</span></span>
<span><span class="co">#&gt; 14     manufacturersubaru    14.00000 1.0000000 0.1910933</span></span>
<span><span class="co">#&gt; 15                   drvf    15.00000 1.0000000 0.1850810</span></span>
<span><span class="co">#&gt; 16                   drvr    16.00000 1.0000000 0.1785056</span></span>
<span><span class="co">#&gt; 17           classminivan    17.00000 1.0000000 0.1723677</span></span>
<span><span class="co">#&gt; 18            classpickup    18.00000 1.0000000 0.1661696</span></span>
<span><span class="co">#&gt; 19               classsuv    19.00000 1.0000000 0.1599071</span></span>
<span><span class="co">#&gt; 20           classmidsize    19.93159 0.9315947 0.1535761</span></span>
<span><span class="co">#&gt; 21        classsubcompact    20.74392 0.8123229 0.1475693</span></span>
<span><span class="co">#&gt; 22           classcompact    21.71027 0.9663480 0.1421899</span></span>
<span><span class="co">#&gt; 23                  displ    21.96954 0.2592742 0.1358348</span></span>
<span><span class="co">#&gt; 24          transauto(s5)    22.16831 0.1987676 0.1335988</span></span>
<span><span class="co">#&gt; 25                    cty    22.35530 0.1869879 0.1316772</span></span>
<span><span class="co">#&gt; 26                    flp    22.52155 0.1662562 0.1297761</span></span></code></pre></div>
<p>On the other hand, Pillai’s trace selects 26 variables in total and
the refitting accuracy is 0.9231. Additionally, <code><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">MASS::lda()</a></code>
would throw an error in this scenario due to the “constant within
groups” issue.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MASS::lda(model~., data = mpg)</span></span>
<span></span>
<span><span class="co">#&gt; Error in lda.default(x, grouping, ...) : </span></span>
<span><span class="co">#&gt;   variables  1  2  3  4  5  6  7  8  9 10 11 12 13 14 27 28 37 38 40 appear to be constant within groups</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="handling-missing-values">Handling Missing Values<a class="anchor" aria-label="anchor" href="#handling-missing-values"></a>
</h2>
<p>The default method to handle missing values are
<code>c(medianFlag, newLevel)</code>. It means that for numerical
variables, missing values are imputed with the median, while for
categorical variables, a new level is assigned to represent missing
values. Additionally, for numerical variables, we generate missing value
indicators to flag which observations had missing data.</p>
<p>Two key functions involved in this process are
<code><a href="../reference/missingFix.html">missingFix()</a></code> and <code><a href="../reference/getDataInShape.html">getDataInShape()</a></code>:</p>
<ul>
<li><p><strong><code><a href="../reference/missingFix.html">missingFix()</a></code></strong> imputes missing values
and outputs two objects: the imputed dataset and a missing reference,
which can be used for future imputations. Any constant columns remains
in the imputed dataset will be removed.</p></li>
<li>
<p><strong><code><a href="../reference/getDataInShape.html">getDataInShape()</a></code></strong> takes new data and
the missing reference as inputs, and returns an imputed dataset. This
function performs several tasks:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Redundant column removal</strong>: Any columns in the new
data that are not present in the reference are removed.</li>
<li>
<strong>Missing column addition</strong>: Columns that are present
in the reference but missing from the new data are added and initialized
according to the missing reference.</li>
<li>
<strong>Flag variable handling</strong>: Missing value indicators
(flag variables) are properly updated to reflect the missing values in
the new data.</li>
<li>
<strong>Factor level updating</strong>: For categorical variables,
factor levels are updated to match the reference. If a factor variable
in the new data contains levels that are not present in the reference,
those levels are removed, and the values are set to match the reference.
Redundant levels are also removed.</li>
</ol>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataset with missing values</span></span>
<span><span class="op">(</span><span class="va">datNA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, <span class="co"># All values are NA</span></span>
<span>                     X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Factor with all NA values</span></span>
<span>                     X3 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="co"># Numeric column with no missing values</span></span>
<span>                     X4 <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="co"># Character column</span></span>
<span>                     X5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="co"># Numeric column with missing values</span></span>
<span>                     X6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Factor with missing values</span></span>
<span><span class="co">#&gt;   X1   X2 X3 X4 X5   X6</span></span>
<span><span class="co">#&gt; 1 NA &lt;NA&gt;  1  A NA    A</span></span>
<span><span class="co">#&gt; 2 NA &lt;NA&gt;  2  B  2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 NA &lt;NA&gt;  3  C  3 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 NA &lt;NA&gt;  4  D 10    B</span></span>
<span><span class="co">#&gt; 5 NA &lt;NA&gt;  5  E NA    B</span></span></code></pre></div>
<p>Impute missing values and create a missing reference:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">imputedSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/missingFix.html">missingFix</a></span><span class="op">(</span><span class="va">datNA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;   X3 X4 X5          X6 X5_FLAG</span></span>
<span><span class="co">#&gt; 1  1  A  3           A       1</span></span>
<span><span class="co">#&gt; 2  2  B  2 new0_0Level       0</span></span>
<span><span class="co">#&gt; 3  3  C  3 new0_0Level       0</span></span>
<span><span class="co">#&gt; 4  4  D 10           B       0</span></span>
<span><span class="co">#&gt; 5  5  E  3           B       1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ref</span></span>
<span><span class="co">#&gt;   X3 X4 X5          X6 X5_FLAG</span></span>
<span><span class="co">#&gt; 1  3  A  3 new0_0Level       1</span></span></code></pre></div>
<p>X1 and X2 are removed because they are constant (i.e., all values are
NA). X3 and X4 remain unchanged. X5 is imputed with the median (3), and
a new column X5_FLAG is added to indicate missing values. X6 is imputed
with a new level ‘new0_0Level’.</p>
<p>Now, let’s create a new dataset for imputation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">datNAnew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="co"># New column not in the reference</span></span>
<span>                        X3 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="co"># Matching column with no NAs</span></span>
<span>                        X4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="st">"F"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Factor with a new level "F" and missing values</span></span>
<span>                        X5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Numeric column with a missing value</span></span>
<span><span class="co">#&gt;   X1 X3   X4 X5</span></span>
<span><span class="co">#&gt; 1  1  1    E NA</span></span>
<span><span class="co">#&gt; 2  2  2    F  2</span></span>
<span><span class="co">#&gt; 3  3  3 &lt;NA&gt;  3</span></span></code></pre></div>
<p>Apply the missing reference to the new dataset:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getDataInShape.html">getDataInShape</a></span><span class="op">(</span><span class="va">datNAnew</span>, <span class="va">imputedSummary</span><span class="op">$</span><span class="va">ref</span><span class="op">)</span></span>
<span><span class="co">#&gt;   X3 X4 X5          X6 X5_FLAG</span></span>
<span><span class="co">#&gt; 1  1  E  3 new0_0Level       1</span></span>
<span><span class="co">#&gt; 2  2  A  2 new0_0Level       0</span></span>
<span><span class="co">#&gt; 3  3  A  3 new0_0Level       0</span></span></code></pre></div>
<p>X1 is removed because it does not exist in the missing reference. X3
remains unchanged. “F” is a new level in X4, so it is removed and
imputed with “A” (the most frequent level) along with other missing
values. X5 is imputed, and a new column X5_FLAG is added to indicate
missing values. X6 is missing from the new data, so it is initialized
with the level “new0_0Level”.</p>
<p>Next, we show an example using <code>folda</code> with the airquality
dataset. First, let’s check which columns in airquality have missing
values:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="va">anyNA</span><span class="op">)</span> <span class="co"># Ozone and Solar.R have NAs</span></span>
<span><span class="co">#&gt;   Ozone Solar.R    Wind    Temp   Month     Day </span></span>
<span><span class="co">#&gt;    TRUE    TRUE   FALSE   FALSE   FALSE   FALSE</span></span></code></pre></div>
<p>Our response variable is the 5th column (Month):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitAir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">airquality</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The generated missing reference is:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitAir</span><span class="op">$</span><span class="va">misReference</span></span>
<span><span class="co">#&gt;   Ozone Solar.R Wind Temp Day Ozone_FLAG Solar.R_FLAG</span></span>
<span><span class="co">#&gt; 1  31.5     205  9.7   79  16          1            1</span></span></code></pre></div>
<p>To make prediction:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitAir</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "6" "6" "6" "6"</span></span></code></pre></div>
<p>Notice that no issues arise during predicting, even when the new data
contains nothing but missing values.</p>
</div>
<div class="section level2">
<h2 id="additional-features">Additional Features<a class="anchor" aria-label="anchor" href="#additional-features"></a>
</h2>
<ul>
<li><p><strong><code>correction</code></strong>: If you’re less
concerned about controlling the type I error and prefer a more
aggressive variable selection process, setting
<code>correction = FALSE</code> may result in better testing accuracy,
particularly when the number of columns exceeds the number of
rows.</p></li>
<li><p><strong><code>alpha</code></strong>: If your goal is to rank all
variables, set <code>alpha = 1</code>. This ensures that no variables
are filtered out during the selection process.</p></li>
<li><p><strong><code>misClassCost</code></strong>: This parameter is
useful in situations where misclassifying certain classes has a more
severe impact compared to others. Below is an example demonstrating how
to incorporate different misclassification costs.</p></li>
</ul>
<p>The iris dataset is a famous dataset with three species of
flowers:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, dnn <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     setosa versicolor  virginica </span></span>
<span><span class="co">#&gt;         50         50         50</span></span></code></pre></div>
<p>Suppose misclassifying versicolor into other species is very costly.
A potential misclassification cost matrix might look like this:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misClassCost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">1</span>,</span>
<span>                         <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                         <span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This means that misclassifying versicolor to other species is 100
times more severe than misclassifying other species to versicolor.
First, let’s fit the model with equal misclassification costs and
specified misclassification costs:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitEqualCost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, response <span class="op">=</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">fitNewCost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folda.html">folda</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, response <span class="op">=</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span>, misClassCost <span class="op">=</span> <span class="va">misClassCost</span><span class="op">)</span></span></code></pre></div>
<p>The prediction distributions with equal misclassification costs:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitEqualCost</span>, <span class="va">iris</span><span class="op">)</span>, dnn <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     setosa versicolor  virginica </span></span>
<span><span class="co">#&gt;         50         49         51</span></span></code></pre></div>
<p>The prediction distributions with specified misclassification
costs:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitNewCost</span>, <span class="va">iris</span><span class="op">)</span>, dnn <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt;     setosa versicolor  virginica </span></span>
<span><span class="co">#&gt;         50         63         37</span></span></code></pre></div>
<p>As shown, the model tends to predict versicolor more often due to the
higher misclassification cost associated with predicting it
incorrectly.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Howland, P., Jeon, M., &amp; Park, H. (2003). <em>Structure
preserving dimension reduction for clustered text data based on the
generalized singular value decomposition</em>. SIAM Journal on Matrix
Analysis and Applications, 25(1), 165-179.</p></li>
<li><p>Rencher, A. C., &amp; Christensen, W. F. (2002). <em>Methods of
multivariate analysis</em> (Vol. 727). John Wiley &amp; Sons.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Siyu Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
